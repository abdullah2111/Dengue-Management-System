{% extends 'core/base.html' %}
{% block title %}Patient Dashboard{% endblock %}

{% block navbar %}
<!-- Empty block to remove the navbar in patient dashboard -->
{% endblock navbar %}

{% block content %}
<div class="container-fluid p-0">
    <div class="row g-0">
        <!-- Sidebar -->
        <div class="col-md-3 col-lg-2 p-0" style="height: 100vh; position: fixed; left: 0; top: 0; background-color: #2c3e50;">
            <!-- Patient Profile Summary -->
            <div class="text-center p-4 border-bottom border-dark">
                <div class="mb-3">
                    <i class="fas fa-user-circle fa-3x text-light"></i>
                </div>
                <h5 class="text-white mb-1">{{ request.user.name }}</h5>
                <small class="text-muted">Patient</small>
            </div>

            <!-- Navigation Menu -->
            <div class="p-3 flex-grow-1">
                <ul class="nav flex-column">
                    <li class="nav-item mb-2">
                        <a href="#" class="nav-link text-white active" id="check-dengue-link">
                            <i class="fas fa-check-circle me-2"></i> Check Dengue
                        </a>
                    </li>
                    <li class="nav-item mb-2">
                        <a href="#" class="nav-link text-white">
                            <i class="fas fa-notes-medical me-2"></i> Track Symptoms
                        </a>
                    </li>
                    <li class="nav-item mb-2">
                        <a href="#" class="nav-link text-white">
                            <i class="fas fa-calendar-plus me-2"></i> Doctor Appointment
                        </a>
                    </li>
                    <li class="nav-item mb-2">
                        <a href="#" class="nav-link text-white">
                            <i class="fas fa-user-cog me-2"></i> Profile
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Logout Button -->
            <div class="p-3 border-top border-dark">
                <a href="{% url 'logout' %}" class="btn btn-danger w-100">
                    <i class="fas fa-sign-out-alt me-2"></i> Logout
                </a>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="col-md-9 col-lg-10 ms-auto p-4" style="background-color: #f8f9fa; margin-left: 25%;">
            <div id="content-area" class="bg-white rounded-3 p-4 shadow-sm">
                <h1 class="display-6 mb-4">Welcome to your Patient Dashboard</h1>
                <p class="text-muted">Select an option from the sidebar to get started.</p>
            </div>

            <!-- Check Dengue Form Section -->
            <div id="check-dengue-form" class="mt-4" style="display:none;">
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="card border-0 shadow">
                            <div class="card-header bg-primary text-white">
                                <h3 class="card-title mb-0 text-center"><i class="fas fa-virus me-2"></i> Dengue Symptom Checker</h3>
                            </div>
                            <div class="card-body p-4">
                                <p class="text-center text-muted mb-4">Please rate the severity of each symptom you're experiencing</p>

                                <form id="dengue-form" class="needs-validation" novalidate>
                                    <div class="row g-3">
                                        <!-- Symptom Fields -->
                                        <div class="col-md-6">
                                            <div class="mb-4">
                                                <label class="form-label fw-bold">Fever</label>
                                                <div class="btn-group w-100" role="group">
                                                    <input type="radio" class="btn-check" name="fever" id="fever0" value="0" autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="fever0">None</label>
                                                    
                                                    <input type="radio" class="btn-check" name="fever" id="fever1" value="1" autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="fever1">Mild</label>
                                                    
                                                    <input type="radio" class="btn-check" name="fever" id="fever2" value="2" autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="fever2">Medium</label>
                                                    
                                                    <input type="radio" class="btn-check" name="fever" id="fever3" value="3" autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="fever3">Severe</label>
                                                </div>
                                            </div>
                                            
                                            <div class="mb-4">
                                                <label class="form-label fw-bold">Headache</label>
                                                <div class="btn-group w-100" role="group">
                                                    <input type="radio" class="btn-check" name="headache" id="headache0" value="0" autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="headache0">None</label>
                                                    
                                                    <input type="radio" class="btn-check" name="headache" id="headache1" value="1" autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="headache1">Mild</label>
                                                    
                                                    <input type="radio" class="btn-check" name="headache" id="headache2" value="2" autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="headache2">Medium</label>
                                                    
                                                    <input type="radio" class="btn-check" name="headache" id="headache3" value="3" autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="headache3">Severe</label>
                                                </div>
                                            </div>
                                            
                                            <div class="mb-4">
                                                <label class="form-label fw-bold">Nausea</label>
                                                <div class="btn-group w-100" role="group">
                                                    <input type="radio" class="btn-check" name="nausea" id="nausea0" value="0" autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="nausea0">None</label>
                                                    
                                                    <input type="radio" class="btn-check" name="nausea" id="nausea1" value="1" autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="nausea1">Mild</label>
                                                    
                                                    <input type="radio" class="btn-check" name="nausea" id="nausea2" value="2" autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="nausea2">Medium</label>
                                                    
                                                    <input type="radio" class="btn-check" name="nausea" id="nausea3" value="3" autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="nausea3">Severe</label>
                                                </div>
                                            </div>
                                            
                                            <div class="mb-4">
                                                <label class="form-label fw-bold">Fatigue</label>
                                                <div class="btn-group w-100" role="group">
                                                    <input type="radio" class="btn-check" name="fatigue" id="fatigue0" value="0" autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="fatigue0">None</label>
                                                    
                                                    <input type="radio" class="btn-check" name="fatigue" id="fatigue1" value="1" autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="fatigue1">Mild</label>
                                                    
                                                    <input type="radio" class="btn-check" name="fatigue" id="fatigue2" value="2" autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="fatigue2">Medium</label>
                                                    
                                                    <input type="radio" class="btn-check" name="fatigue" id="fatigue3" value="3" autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="fatigue3">Severe</label>
                                                </div>
                                            </div>
                                            
                                            <div class="mb-4">
                                                <label class="form-label fw-bold">Joint Pain</label>
                                                <div class="btn-group w-100" role="group">
                                                    <input type="radio" class="btn-check" name="joint_pain" id="joint_pain0" value="0" autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="joint_pain0">None</label>
                                                    
                                                    <input type="radio" class="btn-check" name="joint_pain" id="joint_pain1" value="1" autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="joint_pain1">Mild</label>
                                                    
                                                    <input type="radio" class="btn-check" name="joint_pain" id="joint_pain2" value="2" autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="joint_pain2">Medium</label>
                                                    
                                                    <input type="radio" class="btn-check" name="joint_pain" id="joint_pain3" value="3" autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="joint_pain3">Severe</label>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-6">
                                            <div class="mb-4">
                                                <label class="form-label fw-bold">Rashes</label>
                                                <div class="btn-group w-100" role="group">
                                                    <input type="radio" class="btn-check" name="rashes" id="rashes0" value="0" autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="rashes0">None</label>
                                                    
                                                    <input type="radio" class="btn-check" name="rashes" id="rashes1" value="1" autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="rashes1">Mild</label>
                                                    
                                                    <input type="radio" class="btn-check" name="rashes" id="rashes2" value="2" autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="rashes2">Medium</label>
                                                    
                                                    <input type="radio" class="btn-check" name="rashes" id="rashes3" value="3" autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="rashes3">Severe</label>
                                                </div>
                                            </div>
                                            
                                            <div class="mb-4">
                                                <label class="form-label fw-bold">Back Pain</label>
                                                <div class="btn-group w-100" role="group">
                                                    <input type="radio" class="btn-check" name="back_pain" id="back_pain0" value="0" autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="back_pain0">None</label>
                                                    
                                                    <input type="radio" class="btn-check" name="back_pain" id="back_pain1" value="1" autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="back_pain1">Mild</label>
                                                    
                                                    <input type="radio" class="btn-check" name="back_pain" id="back_pain2" value="2" autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="back_pain2">Medium</label>
                                                    
                                                    <input type="radio" class="btn-check" name="back_pain" id="back_pain3" value="3" autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="back_pain3">Severe</label>
                                                </div>
                                            </div>
                                            
                                            <div class="mb-4">
                                                <label class="form-label fw-bold">Eye Pain</label>
                                                <div class="btn-group w-100" role="group">
                                                    <input type="radio" class="btn-check" name="eye_pain" id="eye_pain0" value="0" autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="eye_pain0">None</label>
                                                    
                                                    <input type="radio" class="btn-check" name="eye_pain" id="eye_pain1" value="1" autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="eye_pain1">Mild</label>
                                                    
                                                    <input type="radio" class="btn-check" name="eye_pain" id="eye_pain2" value="2" autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="eye_pain2">Medium</label>
                                                    
                                                    <input type="radio" class="btn-check" name="eye_pain" id="eye_pain3" value="3" autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="eye_pain3">Severe</label>
                                                </div>
                                            </div>
                                            
                                            <div class="mb-4">
                                                <label class="form-label fw-bold">Vomiting</label>
                                                <div class="btn-group w-100" role="group">
                                                    <input type="radio" class="btn-check" name="vomiting" id="vomiting0" value="0" autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="vomiting0">None</label>
                                                    
                                                    <input type="radio" class="btn-check" name="vomiting" id="vomiting1" value="1" autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="vomiting1">Mild</label>
                                                    
                                                    <input type="radio" class="btn-check" name="vomiting" id="vomiting2" value="2" autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="vomiting2">Medium</label>
                                                    
                                                    <input type="radio" class="btn-check" name="vomiting" id="vomiting3" value="3" autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="vomiting3">Severe</label>
                                                </div>
                                            </div>
                                            
                                            <div class="mb-4">
                                                <label class="form-label fw-bold">Abdominal Pain</label>
                                                <div class="btn-group w-100" role="group">
                                                    <input type="radio" class="btn-check" name="abdominal_pain" id="abdominal_pain0" value="0" autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="abdominal_pain0">None</label>
                                                    
                                                    <input type="radio" class="btn-check" name="abdominal_pain" id="abdominal_pain1" value="1" autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="abdominal_pain1">Mild</label>
                                                    
                                                    <input type="radio" class="btn-check" name="abdominal_pain" id="abdominal_pain2" value="2" autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="abdominal_pain2">Medium</label>
                                                    
                                                    <input type="radio" class="btn-check" name="abdominal_pain" id="abdominal_pain3" value="3" autocomplete="off">
                                                    <label class="btn btn-outline-secondary" for="abdominal_pain3">Severe</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="d-grid gap-2 mt-4">
                                        <button type="submit" class="btn btn-primary btn-lg">
                                            <i class="fas fa-check-circle me-2"></i> Submit Symptoms
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Results Section -->
            <div id="dengue-result" class="row justify-content-center mt-4" style="display:none;">
                <div class="col-lg-8">
                    <div class="card border-0 shadow">
                        <div class="card-header bg-info text-white">
                            <h3 class="card-title mb-0 text-center"><i class="fas fa-clipboard-check me-2"></i> Dengue Risk Assessment</h3>
                        </div>
                        <div class="card-body p-4 text-center">
                            <div class="mb-4">
                                <div class="progress" style="height: 30px;">
                                    <div id="risk-progress-bar" class="progress-bar progress-bar-striped progress-bar-animated bg-danger" role="progressbar" style="width: 0%"></div>
                                </div>
                                <small class="text-muted mt-2 d-block">Your dengue risk percentage</small>
                            </div>
                            
                            <h4 class="mb-3">Prediction Result:</h4>
                            <p class="lead">Your chances of having Dengue are: <span id="dengue-percentage" class="fw-bold">0</span>%</p>
                            
                            <div class="alert alert-warning mt-4" role="alert">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                <strong>Note:</strong> This is not a medical diagnosis. Please consult a healthcare professional for accurate assessment.
                            </div>
                            
                            <div class="d-grid gap-2 d-md-flex justify-content-md-center mt-4">
                                <button class="btn btn-outline-primary me-md-2">
                                    <i class="fas fa-calendar-plus me-2"></i> Book Doctor Appointment
                                </button>
                                <button class="btn btn-outline-secondary">
                                    <i class="fas fa-notes-medical me-2"></i> Track Symptoms
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    // Handle the submission of the dengue form
    document.getElementById('dengue-form').addEventListener('submit', function(e) {
        e.preventDefault();

        // Collect data from the form
        const symptoms = [
            'fever', 'headache', 'nausea', 'fatigue', 'joint_pain',
            'rashes', 'back_pain', 'eye_pain', 'vomiting', 'abdominal_pain'
        ];

        let totalSeverity = 0;
        let answeredCount = 0;

        symptoms.forEach(symptom => {
            const selected = document.querySelector(`input[name="${symptom}"]:checked`);
            if (selected) {
                totalSeverity += parseInt(selected.value);
                answeredCount++;
            }
        });

        // Validate that at least some symptoms are selected
        if (answeredCount === 0) {
            alert('Please rate at least one symptom before submitting.');
            return;
        }

        // Calculate the probability (simplified example)
        const maxSeverity = 30;  // Maximum possible value (3 for each of 10 symptoms)
        const denguePercentage = Math.min((totalSeverity / maxSeverity) * 100, 100).toFixed(2);

        // Display the result
        document.getElementById('check-dengue-form').style.display = 'none';
        document.getElementById('dengue-result').style.display = 'block';
        document.getElementById('dengue-percentage').innerText = denguePercentage;
        
        // Animate the progress bar
        const progressBar = document.getElementById('risk-progress-bar');
        let width = 0;
        const interval = setInterval(() => {
            if (width >= denguePercentage) {
                clearInterval(interval);
            } else {
                width++;
                progressBar.style.width = width + '%';
                progressBar.setAttribute('aria-valuenow', width);
            }
        }, 20);

        // Optionally, save this result to the database or send an email
    });

    // Event listener to show the dengue form
    document.getElementById('check-dengue-link').addEventListener('click', function(e) {
        e.preventDefault();
        document.getElementById('content-area').style.display = 'none';
        document.getElementById('check-dengue-form').style.display = 'block';
        document.getElementById('dengue-result').style.display = 'none';
    });
</script>
{% endblock %}